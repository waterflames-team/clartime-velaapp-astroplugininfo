(()=>{"use strict";let e,t;var o={},i={};function n(e){var t=i[e];if(void 0!==t)return t.exports;var r=i[e]={exports:{}};return o[e](r,r.exports,n),r.exports}function r(){var e,t;if("function"==typeof(null==(t=null==(e=globalThis.AstroBox)?void 0:e.config)?void 0:t.readConfig))return JSON.parse(globalThis.AstroBox.config.readConfig());throw Error("AstroBox.config.readConfig not available on native side")}function l(e){var t,o;if("function"==typeof(null==(o=null==(t=globalThis.AstroBox)?void 0:t.config)?void 0:o.writeConfig))globalThis.AstroBox.config.writeConfig(JSON.stringify(e));else throw Error("AstroBox.config.writeConfig not available on native side")}function a(e){let t=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],o="",i,n=e.length;for(i=2;i<n;i+=3)o+=t[e[i-2]>>2],o+=t[(3&e[i-2])<<4|e[i-1]>>4],o+=t[(15&e[i-1])<<2|e[i]>>6],o+=t[63&e[i]];return i===n+1&&(o+=t[e[i-2]>>2],o+=t[(3&e[i-2])<<4],o+="=="),i===n&&(o+=t[e[i-2]>>2],o+=t[(3&e[i-2])<<4|e[i-1]>>4],o+=t[(15&e[i-1])<<2],o+="="),o}function s(e){if((e=e.replace(/[\r\n\s]/g,"")).length%4!=0)throw Error("Invalid base64 string length");let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0;e.endsWith("==")?o=2:e.endsWith("=")&&(o=1);let i=e.length/4*3-o,n=new Uint8Array(i),r=0;for(let o=0;o<e.length;o+=4){let l=t.indexOf(e[o])<<18|t.indexOf(e[o+1])<<12|t.indexOf(e[o+2])<<6|t.indexOf(e[o+3]);r<i&&(n[r++]=l>>16&255),r<i&&(n[r++]=l>>8&255),r<i&&(n[r++]=255&l)}return n}async function d(e){var t,o;if("function"==typeof(null==(o=null==(t=globalThis.AstroBox)?void 0:t.debug)?void 0:o.sendRaw))await globalThis.AstroBox.debug.sendRaw(a(e));else throw Error("AstroBox.debug.sendRaw not available on native side")}function c(){var e,t;if("function"==typeof(null==(t=null==(e=globalThis.AstroBox)?void 0:e.device)?void 0:t.getDeviceList))return JSON.parse(globalThis.AstroBox.device.getDeviceList());throw Error("AstroBox.device.getDeviceList not available on native side")}function u(e){var t,o;if("function"==typeof(null==(o=null==(t=globalThis.AstroBox)?void 0:t.device)?void 0:o.getDeviceState))return JSON.parse(globalThis.AstroBox.device.getDeviceState(e));throw Error("AstroBox.device.getDeviceState not available on native side")}function v(e,t){var o,i;if("function"==typeof(null==(i=null==(o=globalThis.AstroBox)?void 0:o.device)?void 0:i.modifyDeviceState))globalThis.AstroBox.device.modifyDeviceState(e,JSON.stringify(t));else throw Error("AstroBox.device.modifyDeviceState not available on native side")}async function f(){var e,t;if("function"==typeof(null==(t=null==(e=globalThis.AstroBox)?void 0:e.device)?void 0:t.disconnectDevice))await globalThis.AstroBox.device.disconnectDevice();else throw Error("AstroBox.device.disconnectDevice not available on native side")}function g(e,t){var o,i;if("function"==typeof(null==(i=null==(o=globalThis.AstroBox)?void 0:o.event)?void 0:i.addEventListener))globalThis.AstroBox.event.addEventListener(e,t);else throw Error("AstroBox.event.addEventListener not available")}function y(e){var t,o;if("function"==typeof(null==(o=null==(t=globalThis.AstroBox)?void 0:t.event)?void 0:o.removeEventListener))globalThis.AstroBox.event.removeEventListener(e);else throw Error("AstroBox.event.removeEventListener not available")}function p(e,t){var o,i;if("function"==typeof(null==(i=null==(o=globalThis.AstroBox)?void 0:o.event)?void 0:i.sendEvent))globalThis.AstroBox.event.sendEvent(e,t);else throw Error("AstroBox.event.sendEvent not available")}function b(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{},i=Object.keys(o);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(o).filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable}))),i.forEach(function(t){var i;i=o[t],t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i})}return e}async function h(e){var t,o;let i=b({decode_text:!1,encoding:"undefined"},e);if("function"==typeof(null==(o=null==(t=globalThis.AstroBox)?void 0:t.filesystem)?void 0:o.pickFile))return JSON.parse(await globalThis.AstroBox.filesystem.pickFile(JSON.stringify(i)));throw Error("AstroBox.filesystem.pickFile not available")}async function x(e,t){var o,i;if("function"==typeof(null==(i=null==(o=globalThis.AstroBox)?void 0:o.filesystem)?void 0:i.readFile)){let o=b({offset:0,decode_text:!0},t);var n=await globalThis.AstroBox.filesystem.readFile(e,JSON.stringify(o));return o.decode_text?n:s(n)}throw Error("AstroBox.filesystem.readFile not available")}async function A(e){var t,o;if("function"==typeof(null==(o=null==(t=globalThis.AstroBox)?void 0:t.filesystem)?void 0:o.unloadFile))return await globalThis.AstroBox.filesystem.unloadFile(e);throw Error("AstroBox.filesystem.unloadFile not available")}function B(e,t){var o,i;if("function"==typeof(null==(i=null==(o=globalThis.AstroBox)?void 0:o.installer)?void 0:i[e]))globalThis.AstroBox.installer[e](t);else throw Error("AstroBox.installer.".concat(e," not available"))}n.rv=()=>"1.4.11",n.ruid="bundler=rspack@1.4.11";let w=e=>B("addThirdPartyAppToQueue",e),T=e=>B("addWatchFaceToQueue",e),m=e=>B("addFirmwareToQueue",e);async function S(e,t){var o,i;if("function"==typeof(null==(i=null==(o=globalThis.AstroBox)?void 0:o.interconnect)?void 0:i.sendQAICMessage))await globalThis.AstroBox.interconnect.sendQAICMessage(e,t);else throw Error("AstroBox.interconnect.sendQAICMessage not available")}function E(e){var t,o;if("function"==typeof(null==(o=null==(t=globalThis.AstroBox)?void 0:t.lifecycle)?void 0:o.onLoad))globalThis.AstroBox.lifecycle.onLoad(e);else throw Error("AstroBox.lifecycle.onLoad not available")}function O(e){var t,o;if("function"==typeof(null==(o=null==(t=globalThis.AstroBox)?void 0:t.native)?void 0:o.regNativeFun))return globalThis.AstroBox.native.regNativeFun(e);throw Error("AstroBox.native.regNativeFun not available")}async function P(e,t){var o,i;if("function"==typeof(null==(i=null==(o=globalThis.AstroBox)?void 0:o.network)?void 0:i.fetch)){t.body_encoded="string"!=typeof t.body,t.body=t.body?t.body_encoded?a(t.body):t.body:"";let o=await globalThis.AstroBox.network.fetch(e,JSON.stringify(function(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{},i=Object.keys(o);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(o).filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable}))),i.forEach(function(t){var i;i=o[t],t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i})}return e}({raw:!1},t)));return o.body=t.raw?s(o.body):o.body,o}throw Error("AstroBox.network.fetch not available")}async function N(e){var t,o;if("function"==typeof(null==(o=null==(t=globalThis.AstroBox)?void 0:t.provider)?void 0:o.registerCommunityProvider))await globalThis.AstroBox.provider.registerCommunityProvider(JSON.stringify(e));else throw Error("AstroBox.provider.registerCommunityProvider not available")}async function F(e,t){var o,i;if("function"==typeof(null==(i=null==(o=globalThis.AstroBox)?void 0:o.thirdpartyapp)?void 0:i.launchQA))await globalThis.AstroBox.thirdpartyapp.launchQA(JSON.stringify(e),t);else throw Error("AstroBox.thirdpartyapp.launchQA not available")}async function L(){var e,t;if("function"==typeof(null==(t=null==(e=globalThis.AstroBox)?void 0:e.thirdpartyapp)?void 0:t.getThirdPartyAppList))return JSON.parse(await globalThis.AstroBox.thirdpartyapp.getThirdPartyAppList());throw Error("AstroBox.thirdpartyapp.getThirdPartyAppList not available")}function D(e,t){var o,i;if("function"==typeof(null==(i=null==(o=globalThis.AstroBox)?void 0:o.ui)?void 0:i[e]))globalThis.AstroBox.ui[e](t);else throw Error("AstroBox.ui.".concat(e," not available"))}let I=e=>D("updatePluginSettingsUI",JSON.stringify(e)),_=e=>D("openPageWithNodes",JSON.stringify(e)),k=e=>D("openPageWithUrl",e),C={};!function(e){e.config={},e.config.readConfig=r,e.config.writeConfig=l,e.debug={},e.debug.sendRaw=d,e.device={},e.device.getDeviceList=c,e.device.getDeviceState=u,e.device.modifyDeviceState=v,e.device.disconnectDevice=f,e.event={},e.event.addEventListener=g,e.event.removeEventListener=y,e.event.sendEvent=p,e.installer={},e.installer.addThirdPartyAppToQueue=w,e.installer.addWatchFaceToQueue=T,e.installer.addFirmwareToQueue=m,e.interconnect={},e.interconnect.sendQAICMessage=S,e.lifecycle={},e.lifecycle.onLoad=E,e.native={},e.native.regNativeFun=O,e.network={},e.network.fetch=P,e.provider={},e.provider.registerCommunityProvider=N,e.thirdpartyapp={},e.thirdpartyapp.launchQA=F,e.thirdpartyapp.getThirdPartyAppList=L,e.ui={},e.ui.updatePluginSettingsUI=I,e.ui.openPageWithNodes=_,e.ui.openPageWithUrl=k,e.filesystem={},e.filesystem.pickFile=h,e.filesystem.readFile=x,e.filesystem.unloadFile=A}(C);let J=C.native.regNativeFun(j),Q=C.native.regNativeFun(function(o){t[7].content.value="",C.ui.updatePluginSettingsUI(t),console.log("原始数据读取 in"),console.log(o);try{e=o,console.log("原始数据非空"),console.log(e)}catch(e){console.error(e),t[7].content.value=e,C.ui.updatePluginSettingsUI(t)}}),U=C.native.regNativeFun(function(){try{C.ui.openPageWithUrl("https://cte.waterflames.cn/")}catch(e){console.error("打开浏览器失败:",e),t[7].content.value="打开浏览器失败，请手动前往https://cte.waterflames.cn/",C.ui.updatePluginSettingsUI(t)}});async function j(){if(void 0===e){t[7].content.value="配置信息未能读取",C.ui.updatePluginSettingsUI(t);return}try{if(!(await C.thirdpartyapp.getThirdPartyAppList()).find(e=>"com.waterflames.clartime"==e.package_name)){t[7].content.value="请先安装澄序课程表快应用/连接设备",C.ui.updatePluginSettingsUI(t);return}try{await C.interconnect.sendQAICMessage("com.waterflames.clartime",JSON.stringify(JSON.parse(e))),t[7].content.value="发送成功，如果手环上出现数据加载异常/黑屏，大概率是数据问题，请自行检查；如果手环没有任何反应，请检查是否进入相关传输页面（首次进入会在重启后引导你进入相关页面；如果你完成过应用的向导流程，那你可以在设置页找到相关入口）",C.ui.updatePluginSettingsUI(t);return}catch(e){console.error("课程数据解析或发送失败:",e),t[7].content.value="发送失败，请检查：1.课程数据是否符合json格式/数据是否完整｜2.连接手环后，传输数据前，是否已经重启应用并进入了相关传输界面",C.ui.updatePluginSettingsUI(t);return}}catch(e){console.error(e),t[7].content.value=e,C.ui.updatePluginSettingsUI(t)}}C.lifecycle.onLoad(()=>{t=[{node_id:"tip1",visibility:!0,disabled:!1,content:{type:"Text",value:"欢迎使用澄序课程表同步插件，下面我会一步步带你创建并传输你的课程数据。"}},{node_id:"tip2",visibility:!0,disabled:!1,content:{type:"Text",value:"第一步：请你进入下面这个网站生成你的课程数据，支持 Wakeup 以及澄序官方数据格式的导入与编辑。编辑完成后建议保存文件，并复制网站内生成出来的数据。"}},{node_id:"opencte",visibility:!0,disabled:!1,content:{type:"Button",value:{primary:!0,text:"打开在线课程编辑器",callback_fun_id:U}}},{node_id:"tip3",visibility:!0,disabled:!1,content:{type:"Text",value:"第二步：请你在下方输入框里粘贴你在第一步生成的课程数据。（请确保复制完整，部分手机输入法可能因为字数过长而无法完整粘贴，亲测微信输入法粘贴正常）"}},{node_id:"OriginalData",visibility:!0,disabled:!1,content:{type:"Input",value:{text:"",callback_fun_id:Q}}},{node_id:"tip4",visibility:!0,disabled:!1,content:{type:"Text",value:"第三步：接下来请你确定 astrobox 是否已经连接手环，随后在手环上关闭并重新打开澄序课程表，进入传输相关页面，以保证此插件能与应用正常通信。当这些都完成以后你就可以点击发送了。"}},{node_id:"send",visibility:!0,disabled:!1,content:{type:"Button",value:{primary:!0,text:"发送",callback_fun_id:J}}},{node_id:"attention",visibility:!0,disabled:!1,content:{type:"Text",value:""}}],C.ui.updatePluginSettingsUI(t)})})();