(()=>{"use strict";let e,t,i;var o={},n={};function r(e){var t=n[e];if(void 0!==t)return t.exports;var i=n[e]={exports:{}};return o[e](i,i.exports,r),i.exports}function l(){var e,t;if("function"==typeof(null==(t=null==(e=globalThis.AstroBox)?void 0:e.config)?void 0:t.readConfig))return JSON.parse(globalThis.AstroBox.config.readConfig());throw Error("AstroBox.config.readConfig not available on native side")}function a(e){var t,i;if("function"==typeof(null==(i=null==(t=globalThis.AstroBox)?void 0:t.config)?void 0:i.writeConfig))globalThis.AstroBox.config.writeConfig(JSON.stringify(e));else throw Error("AstroBox.config.writeConfig not available on native side")}function s(e){let t=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],i="",o,n=e.length;for(o=2;o<n;o+=3)i+=t[e[o-2]>>2],i+=t[(3&e[o-2])<<4|e[o-1]>>4],i+=t[(15&e[o-1])<<2|e[o]>>6],i+=t[63&e[o]];return o===n+1&&(i+=t[e[o-2]>>2],i+=t[(3&e[o-2])<<4],i+="=="),o===n&&(i+=t[e[o-2]>>2],i+=t[(3&e[o-2])<<4|e[o-1]>>4],i+=t[(15&e[o-1])<<2],i+="="),i}function d(e){if((e=e.replace(/[\r\n\s]/g,"")).length%4!=0)throw Error("Invalid base64 string length");let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0;e.endsWith("==")?i=2:e.endsWith("=")&&(i=1);let o=e.length/4*3-i,n=new Uint8Array(o),r=0;for(let i=0;i<e.length;i+=4){let l=t.indexOf(e[i])<<18|t.indexOf(e[i+1])<<12|t.indexOf(e[i+2])<<6|t.indexOf(e[i+3]);r<o&&(n[r++]=l>>16&255),r<o&&(n[r++]=l>>8&255),r<o&&(n[r++]=255&l)}return n}async function c(e){var t,i;if("function"==typeof(null==(i=null==(t=globalThis.AstroBox)?void 0:t.debug)?void 0:i.sendRaw))await globalThis.AstroBox.debug.sendRaw(s(e));else throw Error("AstroBox.debug.sendRaw not available on native side")}function u(){var e,t;if("function"==typeof(null==(t=null==(e=globalThis.AstroBox)?void 0:e.device)?void 0:t.getDeviceList))return JSON.parse(globalThis.AstroBox.device.getDeviceList());throw Error("AstroBox.device.getDeviceList not available on native side")}function v(e){var t,i;if("function"==typeof(null==(i=null==(t=globalThis.AstroBox)?void 0:t.device)?void 0:i.getDeviceState))return JSON.parse(globalThis.AstroBox.device.getDeviceState(e));throw Error("AstroBox.device.getDeviceState not available on native side")}function f(e,t){var i,o;if("function"==typeof(null==(o=null==(i=globalThis.AstroBox)?void 0:i.device)?void 0:o.modifyDeviceState))globalThis.AstroBox.device.modifyDeviceState(e,JSON.stringify(t));else throw Error("AstroBox.device.modifyDeviceState not available on native side")}async function g(){var e,t;if("function"==typeof(null==(t=null==(e=globalThis.AstroBox)?void 0:e.device)?void 0:t.disconnectDevice))await globalThis.AstroBox.device.disconnectDevice();else throw Error("AstroBox.device.disconnectDevice not available on native side")}function p(e,t){var i,o;if("function"==typeof(null==(o=null==(i=globalThis.AstroBox)?void 0:i.event)?void 0:o.addEventListener))globalThis.AstroBox.event.addEventListener(e,t);else throw Error("AstroBox.event.addEventListener not available")}function y(e){var t,i;if("function"==typeof(null==(i=null==(t=globalThis.AstroBox)?void 0:t.event)?void 0:i.removeEventListener))globalThis.AstroBox.event.removeEventListener(e);else throw Error("AstroBox.event.removeEventListener not available")}function h(e,t){var i,o;if("function"==typeof(null==(o=null==(i=globalThis.AstroBox)?void 0:i.event)?void 0:o.sendEvent))globalThis.AstroBox.event.sendEvent(e,t);else throw Error("AstroBox.event.sendEvent not available")}function b(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{},o=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(i).filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),o.forEach(function(t){var o;o=i[t],t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o})}return e}async function x(e){var t,i;let o=b({decode_text:!1,encoding:"undefined"},e);if("function"==typeof(null==(i=null==(t=globalThis.AstroBox)?void 0:t.filesystem)?void 0:i.pickFile))return JSON.parse(await globalThis.AstroBox.filesystem.pickFile(JSON.stringify(o)));throw Error("AstroBox.filesystem.pickFile not available")}async function A(e,t){var i,o;if("function"==typeof(null==(o=null==(i=globalThis.AstroBox)?void 0:i.filesystem)?void 0:o.readFile)){let i=b({offset:0,decode_text:!0},t);var n=await globalThis.AstroBox.filesystem.readFile(e,JSON.stringify(i));return i.decode_text?n:d(n)}throw Error("AstroBox.filesystem.readFile not available")}async function B(e){var t,i;if("function"==typeof(null==(i=null==(t=globalThis.AstroBox)?void 0:t.filesystem)?void 0:i.unloadFile))return await globalThis.AstroBox.filesystem.unloadFile(e);throw Error("AstroBox.filesystem.unloadFile not available")}function w(e,t){var i,o;if("function"==typeof(null==(o=null==(i=globalThis.AstroBox)?void 0:i.installer)?void 0:o[e]))globalThis.AstroBox.installer[e](t);else throw Error("AstroBox.installer.".concat(e," not available"))}r.rv=()=>"1.4.8",r.ruid="bundler=rspack@1.4.8";let T=e=>w("addThirdPartyAppToQueue",e),m=e=>w("addWatchFaceToQueue",e),E=e=>w("addFirmwareToQueue",e);async function S(e,t){var i,o;if("function"==typeof(null==(o=null==(i=globalThis.AstroBox)?void 0:i.interconnect)?void 0:o.sendQAICMessage))await globalThis.AstroBox.interconnect.sendQAICMessage(e,t);else throw Error("AstroBox.interconnect.sendQAICMessage not available")}function P(e){var t,i;if("function"==typeof(null==(i=null==(t=globalThis.AstroBox)?void 0:t.lifecycle)?void 0:i.onLoad))globalThis.AstroBox.lifecycle.onLoad(e);else throw Error("AstroBox.lifecycle.onLoad not available")}function O(e){var t,i;if("function"==typeof(null==(i=null==(t=globalThis.AstroBox)?void 0:t.native)?void 0:i.regNativeFun))return globalThis.AstroBox.native.regNativeFun(e);throw Error("AstroBox.native.regNativeFun not available")}async function F(e,t){var i,o;if("function"==typeof(null==(o=null==(i=globalThis.AstroBox)?void 0:i.network)?void 0:o.fetch)){t.body=s(t.body);let i=await globalThis.AstroBox.network.fetch(e,JSON.stringify(t));return i.body=d(i.body),i}throw Error("AstroBox.network.fetch not available")}async function N(e){var t,i;if("function"==typeof(null==(i=null==(t=globalThis.AstroBox)?void 0:t.provider)?void 0:i.registerCommunityProvider))await globalThis.AstroBox.provider.registerCommunityProvider(JSON.stringify(e));else throw Error("AstroBox.provider.registerCommunityProvider not available")}async function L(e,t){var i,o;if("function"==typeof(null==(o=null==(i=globalThis.AstroBox)?void 0:i.thirdpartyapp)?void 0:o.launchQA))await globalThis.AstroBox.thirdpartyapp.launchQA(JSON.stringify(e),t);else throw Error("AstroBox.thirdpartyapp.launchQA not available")}async function C(){var e,t;if("function"==typeof(null==(t=null==(e=globalThis.AstroBox)?void 0:e.thirdpartyapp)?void 0:t.getThirdPartyAppList))return JSON.parse(await globalThis.AstroBox.thirdpartyapp.getThirdPartyAppList());throw Error("AstroBox.thirdpartyapp.getThirdPartyAppList not available")}function D(e,t){var i,o;if("function"==typeof(null==(o=null==(i=globalThis.AstroBox)?void 0:i.ui)?void 0:o[e]))globalThis.AstroBox.ui[e](t);else throw Error("AstroBox.ui.".concat(e," not available"))}let k=e=>D("updatePluginSettingsUI",JSON.stringify(e)),I=e=>D("openPageWithNodes",JSON.stringify(e)),J=e=>D("openPageWithUrl",e),Q={};!function(e){e.config={},e.config.readConfig=l,e.config.writeConfig=a,e.debug={},e.debug.sendRaw=c,e.device={},e.device.getDeviceList=u,e.device.getDeviceState=v,e.device.modifyDeviceState=f,e.device.disconnectDevice=g,e.event={},e.event.addEventListener=p,e.event.removeEventListener=y,e.event.sendEvent=h,e.installer={},e.installer.addThirdPartyAppToQueue=T,e.installer.addWatchFaceToQueue=m,e.installer.addFirmwareToQueue=E,e.interconnect={},e.interconnect.sendQAICMessage=S,e.lifecycle={},e.lifecycle.onLoad=P,e.native={},e.native.regNativeFun=O,e.network={},e.network.fetch=F,e.provider={},e.provider.registerCommunityProvider=N,e.thirdpartyapp={},e.thirdpartyapp.launchQA=L,e.thirdpartyapp.getThirdPartyAppList=C,e.ui={},e.ui.updatePluginSettingsUI=k,e.ui.openPageWithNodes=I,e.ui.openPageWithUrl=J,e.filesystem={},e.filesystem.pickFile=x,e.filesystem.readFile=A,e.filesystem.unloadFile=B}(Q);let U=Q.native.regNativeFun(j),_=Q.native.regNativeFun(W);async function W(){var o;try{i=await Q.filesystem.pickFile({decode_text:!0})}catch(e){console.error(e),t[2].content.value=e.message,Q.ui.updatePluginSettingsUI(t)}if(!i.path.endsWith(".json")){t[2].content.value="请选择.json文件",Q.ui.updatePluginSettingsUI(t);return}e=await Q.filesystem.readFile(i.path,{len:i.text_len,decode_text:!0}),t[2].content.value="已选择文件 ".concat((o=i.path)&&o.replace(/\\/g,"/").split("/").pop()||"",", 现在请你在手环上重新打开澄序课程表，进入数据接收状态"),t[3].content.value="",t[1].disabled=!1,Q.ui.updatePluginSettingsUI(t)}async function j(){if(!e){t[2].content.value="请先加载配置",Q.ui.updatePluginSettingsUI(t);return}try{if(!(await Q.thirdpartyapp.getThirdPartyAppList()).find(e=>"com.waterflames.clartime"==e.package_name)){t[2].content.value="请先安装澄序课程表快应用",Q.ui.updatePluginSettingsUI(t);return}await Q.interconnect.sendQAICMessage("com.waterflames.clartime",JSON.stringify(JSON.parse(e))),t[2].content.value="发送成功",Q.ui.updatePluginSettingsUI(t)}catch(e){console.error(e),t[2].content.value=e.message,Q.ui.updatePluginSettingsUI(t)}}Q.lifecycle.onLoad(()=>{t=[{node_id:"pickFile",visibility:!0,disabled:!1,content:{type:"Button",value:{primary:!0,text:"选择配置文件",callback_fun_id:_}}},{node_id:"send",visibility:!0,disabled:!0,content:{type:"Button",value:{primary:!0,text:"发送",callback_fun_id:U}}},{node_id:"attention",visibility:!0,disabled:!1,content:{type:"Text",value:"未选择文件"}},{node_id:"tip",visibility:!0,disabled:!1,content:{type:"Text",value:"注意：请你先在手环上退出澄序课程表，以保证此插件能与应用正常通信"}}],Q.ui.updatePluginSettingsUI(t)})})();
//# sourceMappingURL=main.js.map